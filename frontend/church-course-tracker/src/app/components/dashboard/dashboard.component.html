<div class="dashboard-container">
  <div class="dashboard-header">
    <h1>Dashboard</h1>
    <button mat-raised-button color="primary" (click)="refreshDashboard()" [disabled]="isLoading">
      <mat-icon>refresh</mat-icon>
      Refresh
    </button>
  </div>

  <div *ngIf="isLoading" class="loading-container">
    <mat-spinner></mat-spinner>
    <p>Loading dashboard data...</p>
  </div>

  <div *ngIf="!isLoading && stats" class="dashboard-content">
    <!-- Stats Cards -->
    <div class="stats-grid">
      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon courses-icon">
              <mat-icon>school</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ stats.total_courses }}</h3>
              <p>Total Courses</p>
              <small>{{ stats.active_courses }} active</small>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon enrollments-icon">
              <mat-icon>assignment</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ stats.total_enrollments }}</h3>
              <p>Total Enrollments</p>
              <small>{{ stats.completed_enrollments }} completed</small>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon members-icon">
              <mat-icon>people</mat-icon>
            </div>
            <div class="stat-info">
              <h3>{{ stats.total_members }}</h3>
              <p>Total Members</p>
              <small>Active learners</small>
            </div>
          </div>
        </mat-card-content>
      </mat-card>

      <mat-card class="stat-card">
        <mat-card-content>
          <div class="stat-content">
            <div class="stat-icon completion-icon">
              <mat-icon>trending_up</mat-icon>
            </div>
            <div class="stat-info">
              <h3 [style.color]="getCompletionRateColor()">{{ getCompletionRate() | number:'1.1-1' }}%</h3>
              <p>Completion Rate</p>
              <small>Overall progress</small>
            </div>
          </div>
        </mat-card-content>
      </mat-card>
    </div>

    <!-- Charts Section -->
    <div class="charts-section">
      <div class="chart-container">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Course Completion Overview</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-wrapper">
              <canvas 
                baseChart
                [data]="completionChartData"
                [options]="completionChartOptions"
                type="doughnut">
              </canvas>
            </div>
          </mat-card-content>
        </mat-card>
      </div>

      <div class="chart-container">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Enrollment Trends</mat-card-title>
          </mat-card-header>
          <mat-card-content>
            <div class="chart-wrapper">
              <canvas 
                baseChart
                [data]="enrollmentTrendsData"
                [options]="enrollmentTrendsOptions"
                type="line">
              </canvas>
            </div>
          </mat-card-content>
        </mat-card>
      </div>
    </div>

    <!-- Recent Activity Section -->
    <div class="activity-section">
      <div class="recent-courses">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Recent Courses</mat-card-title>
            <mat-card-subtitle>Latest course additions</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="recentCourses.length === 0" class="no-data">
              <mat-icon>school</mat-icon>
              <p>No recent courses</p>
            </div>
            <div *ngFor="let course of recentCourses" class="course-item">
              <div class="course-info">
                <h4>{{ course.title }}</h4>
                <p>{{ course.description | slice:0:100 }}...</p>
                <small>{{ course.duration_weeks }} weeks â€¢ Created {{ course.created_at | date:'short' }}</small>
              </div>
              <div class="course-status">
                <mat-chip [color]="course.is_active ? 'primary' : 'warn'" selected>
                  {{ course.is_active ? 'Active' : 'Inactive' }}
                </mat-chip>
              </div>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button routerLink="/courses">View All Courses</button>
          </mat-card-actions>
        </mat-card>
      </div>

      <div class="recent-enrollments">
        <mat-card>
          <mat-card-header>
            <mat-card-title>Recent Enrollments</mat-card-title>
            <mat-card-subtitle>Latest student enrollments</mat-card-subtitle>
          </mat-card-header>
          <mat-card-content>
            <div *ngIf="recentEnrollments.length === 0" class="no-data">
              <mat-icon>assignment</mat-icon>
              <p>No recent enrollments</p>
            </div>
            <div *ngFor="let enrollment of recentEnrollments" class="enrollment-item">
              <div class="enrollment-info">
                <h4>{{ enrollment.person?.first_name }} {{ enrollment.person?.last_name }}</h4>
                <p>{{ enrollment.course?.title }}</p>
                <small>Enrolled {{ enrollment.enrolled_at | date:'short' }}</small>
              </div>
              <div class="enrollment-progress">
                <mat-progress-bar 
                  mode="determinate" 
                  [value]="enrollment.progress_percentage">
                </mat-progress-bar>
                <small>{{ enrollment.progress_percentage | number:'1.0-0' }}%</small>
              </div>
            </div>
          </mat-card-content>
          <mat-card-actions>
            <button mat-button routerLink="/enrollments">View All Enrollments</button>
          </mat-card-actions>
        </mat-card>
      </div>
    </div>
  </div>
</div>
